<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>KMJK - Project Estimate</title>
    <style>
        @media print {
            body {
                margin: 0;
                padding: 0;
                background: white;
                font-size: 10pt;
                line-height: 1.3;
            }
            .no-print {
                display: none;
            }
            .print-only {
                display: block !important;
            }
            .digital-acceptance {
                display: none !important;
            }
            .container {
                box-shadow: none;
                max-width: 100%;
            }
            .content {
                padding: 15px 30px;
            }
            .letterhead {
                padding: 15px 30px 10px;
            }
            .company-name {
                font-size: 1.8em !important;
                margin-bottom: 5px !important;
                letter-spacing: 0.1em !important;
            }
            .gold-underline {
                width: 80px !important;
                height: 2px !important;
                margin: 8px 0 10px !important;
            }
            .tagline {
                font-size: 0.85em !important;
                margin-bottom: 10px !important;
            }
            .contact-info {
                font-size: 0.75em !important;
                padding-top: 8px !important;
                gap: 15px !important;
            }
            .doc-header {
                padding: 15px 30px;
            }
            .doc-header-top {
                margin-bottom: 15px !important;
            }
            .doc-title {
                font-size: 1.5em !important;
            }
            .estimate-value {
                font-size: 1.1em !important;
            }
            .client-info-grid {
                gap: 20px !important;
            }
            .info-block h3 {
                font-size: 0.85em !important;
                margin-bottom: 8px !important;
            }
            .info-block p {
                font-size: 0.85em !important;
                margin-bottom: 3px !important;
            }
            .section {
                page-break-inside: avoid;
                break-inside: avoid;
                margin-bottom: 18px !important;
            }
            .section-title {
                font-size: 1.1em !important;
                margin-bottom: 10px !important;
                padding-bottom: 6px !important;
            }
            .section-icon {
                font-size: 0.9em !important;
            }
            .work-items {
                padding: 15px !important;
            }
            .work-item {
                padding: 8px 0 !important;
            }
            .work-item-text {
                font-size: 0.85em !important;
                line-height: 1.3 !important;
            }
            .pricing-table {
                page-break-inside: avoid;
                margin: 12px 0 !important;
            }
            .pricing-table th,
            .pricing-table td {
                padding: 8px 10px !important;
                font-size: 0.85em !important;
            }
            .payment-schedule {
                page-break-inside: avoid;
                margin: 15px 0 !important;
                gap: 15px !important;
            }
            .payment-card {
                padding: 12px !important;
            }
            .payment-number {
                width: 28px !important;
                height: 28px !important;
                line-height: 28px !important;
                font-size: 0.9em !important;
                margin-bottom: 10px !important;
            }
            .payment-title {
                font-size: 0.95em !important;
                margin-bottom: 6px !important;
            }
            .payment-detail {
                font-size: 0.8em !important;
                margin-bottom: 5px !important;
            }
            .payment-amount {
                font-size: 1.2em !important;
                margin-top: 10px !important;
            }
            .terms-box {
                padding: 15px !important;
                margin: 15px 0 !important;
            }
            .terms-box h4 {
                font-size: 0.95em !important;
                margin-bottom: 10px !important;
            }
            .terms-box li {
                padding: 5px 0 5px 20px !important;
                font-size: 0.8em !important;
                line-height: 1.3 !important;
            }
            .validity-notice {
                padding: 12px !important;
                margin: 15px 0 !important;
            }
            .validity-notice p {
                font-size: 0.85em !important;
            }
            .validity-date {
                font-size: 0.95em !important;
            }
            .signature-section {
                page-break-inside: avoid;
                margin-top: 20px !important;
                padding-top: 20px !important;
            }
            .signature-grid {
                margin-top: 20px !important;
                gap: 30px !important;
            }
            .signature-block h4 {
                font-size: 0.85em !important;
                margin-bottom: 25px !important;
            }
            .sig-name {
                font-size: 0.9em !important;
            }
            .sig-label,
            .sig-date {
                font-size: 0.75em !important;
            }
            .payment-options {
                padding: 15px !important;
                margin-top: 15px !important;
            }
            .cashapp-callout {
                gap: 20px !important;
                margin-top: 12px !important;
            }
            .cashapp-info p {
                font-size: 0.8em !important;
                margin-bottom: 8px !important;
            }
            .cashapp-qr {
                flex: 0 0 140px !important;
            }
            .cashapp-qr img {
                max-width: 140px !important;
            }
            .footer {
                padding: 8px 30px !important;
                text-align: center !important;
                margin-top: 10px !important;
            }
            .footer-main {
                font-size: 0.8em !important;
                margin-bottom: 4px !important;
            }
            .footer-divider {
                width: 60px !important;
                height: 1px !important;
                margin: 6px auto !important;
            }
            .footer-contact {
                font-size: 0.7em !important;
                margin-bottom: 3px !important;
            }
            .footer-tagline {
                font-size: 0.65em !important;
                margin-top: 4px !important;
            }
            /* Thank you section compact */
            .content > div[style*="margin-top: 40px"] {
                margin-top: 15px !important;
                padding: 12px !important;
            }
            .content > div[style*="margin-top: 40px"] p {
                margin-bottom: 5px !important;
                font-size: 0.85em !important;
                line-height: 1.3 !important;
            }
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Georgia', 'Times New Roman', serif;
            background: #F8F8F8;
            padding: 40px 20px;
            color: #2C2C2C;
            line-height: 1.6;
        }
        
        .container {
            max-width: 8.5in;
            margin: 0 auto;
            background: white;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
        }
        
        /* Letterhead */
        .letterhead {
            background: #2C2C2C;
            color: #F8F8F8;
            padding: 40px 60px 30px;
        }
        
        .company-name {
            font-size: 3em;
            font-weight: 700;
            letter-spacing: 0.15em;
            margin-bottom: 10px;
        }
        
        .gold-underline {
            width: 150px;
            height: 3px;
            background: linear-gradient(to right, #B8860B, transparent);
            margin: 15px 0 20px;
        }
        
        .tagline {
            font-size: 1em;
            font-weight: 300;
            letter-spacing: 0.05em;
            color: #B8860B;
            margin-bottom: 20px;
        }
        
        .contact-info {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 20px;
            font-size: 0.85em;
            color: #F8F8F8;
            padding-top: 15px;
            border-top: 1px solid rgba(184, 134, 11, 0.3);
        }
        
        .contact-item {
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .contact-icon {
            color: #B8860B;
            font-size: 1.1em;
        }
        
        /* Document Header */
        .doc-header {
            background: linear-gradient(135deg, #F8F8F8 0%, #FFFFFF 100%);
            padding: 30px 60px;
            border-bottom: 3px solid #B8860B;
        }
        
        .doc-header-top {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 25px;
        }
        
        .doc-title {
            font-size: 2.2em;
            font-weight: 600;
            color: #2C2C2C;
        }
        
        .estimate-number {
            text-align: right;
        }
        
        .estimate-label {
            font-size: 0.9em;
            color: #666;
            margin-bottom: 5px;
        }
        
        .estimate-value {
            font-size: 1.3em;
            font-weight: 600;
            color: #B8860B;
        }
        
        .client-info-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
        }
        
        .info-block h3 {
            font-size: 1em;
            color: #B8860B;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            margin-bottom: 12px;
            font-weight: 600;
        }
        
        .info-block p {
            color: #2C2C2C;
            margin-bottom: 5px;
            font-size: 0.95em;
        }
        
        .info-block .highlight {
            font-weight: 600;
        }
        
        /* Content */
        .content {
            padding: 40px 60px;
        }
        
        .section {
            margin-bottom: 35px;
        }
        
        .section-title {
            font-size: 1.4em;
            font-weight: 600;
            color: #2C2C2C;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid #B8860B;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .section-icon {
            color: #B8860B;
            font-size: 1.1em;
        }
        
        /* Scope of Work */
        .work-items {
            background: #F8F8F8;
            border-radius: 8px;
            padding: 25px;
            border: 2px solid #E0E0E0;
        }
        
        .work-item {
            display: flex;
            gap: 15px;
            padding: 15px 0;
            border-bottom: 1px solid #D0D0D0;
        }
        
        .work-item:last-child {
            border-bottom: none;
        }
        
        .work-item-bullet {
            color: #B8860B;
            font-weight: bold;
            font-size: 1.2em;
            flex-shrink: 0;
        }
        
        .work-item-text {
            color: #2C2C2C;
            line-height: 1.6;
        }
        
        /* Pricing Table */
        .pricing-table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
            background: white;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
        }
        
        .pricing-table thead {
            background: #2C2C2C;
            color: white;
        }
        
        .pricing-table th {
            padding: 15px 20px;
            text-align: left;
            font-weight: 600;
            letter-spacing: 0.03em;
        }
        
        .pricing-table th:last-child {
            text-align: right;
        }
        
        .pricing-table tbody tr {
            border-bottom: 1px solid #E0E0E0;
        }
        
        .pricing-table td {
            padding: 18px 20px;
            color: #2C2C2C;
        }
        
        .pricing-table td:last-child {
            text-align: right;
            font-weight: 600;
        }
        
        .pricing-table .tax-row td {
            background: #FBFBFB;
            font-weight: 500;
        }
        
        .pricing-table .total-row {
            background: linear-gradient(135deg, #FFF9E6 0%, #FFFBF0 100%);
            border-top: 3px solid #B8860B;
            font-weight: 600;
            font-size: 1.1em;
        }
        
        .pricing-table .total-row td {
            padding: 20px;
            color: #2C2C2C;
        }
        
        .total-amount {
            color: #B8860B;
            font-size: 1.3em;
        }
        
        /* Payment Schedule */
        .payment-schedule {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 20px;
            margin: 25px 0;
        }
        
        .payment-card {
            background: white;
            border: 2px solid #B8860B;
            border-radius: 8px;
            padding: 25px;
            position: relative;
            overflow: hidden;
        }
        
        .payment-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 5px;
            background: linear-gradient(to right, #B8860B, #D4A522);
        }
        
        .payment-number {
            display: inline-block;
            background: #B8860B;
            color: white;
            width: 35px;
            height: 35px;
            border-radius: 50%;
            text-align: center;
            line-height: 35px;
            font-weight: bold;
            margin-bottom: 15px;
        }
        
        .payment-title {
            font-size: 1.1em;
            font-weight: 600;
            color: #2C2C2C;
            margin-bottom: 10px;
        }
        
        .payment-detail {
            color: #555;
            margin-bottom: 8px;
            font-size: 0.95em;
        }
        
        .payment-amount {
            font-size: 1.5em;
            font-weight: bold;
            color: #B8860B;
            margin-top: 15px;
        }
        
        /* Terms Box */
        .terms-box {
            background: #FFF9E6;
            border-left: 5px solid #B8860B;
            border-radius: 8px;
            padding: 25px;
            margin: 25px 0;
        }
        
        .terms-box h4 {
            color: #2C2C2C;
            font-size: 1.1em;
            margin-bottom: 15px;
        }
        
        .terms-box ul {
            list-style: none;
            padding-left: 0;
        }
        
        .terms-box li {
            padding: 8px 0 8px 25px;
            position: relative;
            color: #2C2C2C;
            line-height: 1.6;
        }
        
        .terms-box li:before {
            content: "‚úì";
            position: absolute;
            left: 0;
            color: #B8860B;
            font-weight: bold;
        }
        
        /* Validity Notice */
        .validity-notice {
            background: linear-gradient(135deg, #E8F4F8 0%, #F0F8FB 100%);
            border: 2px solid #5DADE2;
            border-radius: 8px;
            padding: 20px;
            text-align: center;
            margin: 30px 0;
        }
        
        .validity-notice p {
            color: #2C2C2C;
            font-weight: 600;
            margin-bottom: 5px;
        }
        
        .validity-date {
            color: #5DADE2;
            font-size: 1.1em;
            font-weight: bold;
        }
        
        /* Signature Section */
        .signature-section {
            margin-top: 50px;
            padding-top: 30px;
            border-top: 2px solid #E0E0E0;
        }
        
        .signature-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 50px;
            margin-top: 30px;
        }
        
        .signature-block h4 {
            font-size: 1em;
            color: #B8860B;
            margin-bottom: 40px;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }
        
        .signature-line {
            border-top: 2px solid #2C2C2C;
            padding-top: 10px;
        }
        
        .sig-name {
            font-weight: 600;
            color: #2C2C2C;
            margin-bottom: 5px;
        }
        
        .sig-label {
            font-size: 0.85em;
            color: #666;
            margin-bottom: 3px;
        }
        
        .sig-date {
            font-size: 0.85em;
            color: #666;
            margin-top: 15px;
        }
        
        .print-only {
            display: none;
        }
        
        .hidden {
            display: none !important;
        }
        
        .digital-acceptance {
            margin-top: 50px;
            padding: 30px;
            background: linear-gradient(135deg, #FFFFFF 0%, #F4F4F4 100%);
            border: 1px solid #E0E0E0;
            border-radius: 10px;
            box-shadow: 0 8px 24px rgba(0,0,0,0.08);
        }
        
        .signature-form {
            display: grid;
            gap: 24px;
            margin-top: 20px;
        }
        
        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
            gap: 20px;
        }
        
        .form-field label {
            display: block;
            font-size: 0.85em;
            letter-spacing: 0.05em;
            text-transform: uppercase;
            color: #666;
            margin-bottom: 6px;
        }
        
        .form-field input,
        .form-field textarea {
            width: 100%;
            padding: 12px 14px;
            border: 1px solid #D0D0D0;
            border-radius: 6px;
            font-size: 1em;
            font-family: 'Georgia', 'Times New Roman', serif;
            background: #FFFFFF;
            color: #2C2C2C;
            transition: border-color 0.2s ease, box-shadow 0.2s ease;
        }
        
        .form-field input:focus,
        .form-field textarea:focus {
            outline: none;
            border-color: #B8860B;
            box-shadow: 0 0 0 3px rgba(184, 134, 11, 0.2);
        }
        
        .signature-pad {
            background: #FFFFFF;
            border: 1px dashed #B8860B;
            border-radius: 8px;
            padding: 16px;
        }
        
        .signature-pad canvas {
            width: 100%;
            height: 170px;
            background: #FFFFFF;
            border: 1px solid #E0E0E0;
            border-radius: 6px;
            box-shadow: inset 0 1px 4px rgba(0,0,0,0.08);
            cursor: crosshair;
            touch-action: none;
        }
        
        .signature-pad p {
            font-size: 0.8em;
            color: #666;
            margin-bottom: 10px;
        }
        
        .signature-actions {
            display: flex;
            justify-content: flex-end;
            margin-top: 10px;
        }
        
        .signature-actions button {
            background: transparent;
            border: none;
            color: #B8860B;
            font-size: 0.9em;
            letter-spacing: 0.04em;
            text-transform: uppercase;
            cursor: pointer;
        }
        
        .signature-actions button:hover {
            text-decoration: underline;
        }
        
        .acceptance-checkbox {
            display: flex;
            align-items: flex-start;
            gap: 12px;
            font-size: 0.95em;
            color: #2C2C2C;
            line-height: 1.6;
        }
        
        .acceptance-checkbox input {
            margin-top: 2px;
            width: 22px;
            height: 22px;
            accent-color: #B8860B;
            flex-shrink: 0;
        }
        
        .acceptance-checkbox span {
            display: block;
        }
        
        .accept-button {
            position: relative;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            padding: 14px 24px;
            background: linear-gradient(135deg, #B8860B 0%, #D9B45B 100%);
            color: #FFFFFF;
            border: none;
            border-radius: 30px;
            font-size: 1em;
            font-weight: 600;
            letter-spacing: 0.05em;
            text-transform: uppercase;
            cursor: pointer;
            transition: transform 0.2s ease, box-shadow 0.2s ease, opacity 0.3s ease;
            box-shadow: 0 6px 14px rgba(184, 134, 11, 0.3);
        }
        
        .accept-button:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 10px 18px rgba(184, 134, 11, 0.35);
        }
        
        .accept-button:disabled {
            cursor: not-allowed;
            opacity: 0.65;
            box-shadow: none;
        }
        
        .thank-you-card {
            display: none;
            margin-top: 30px;
            padding: 30px;
            background: #FFFFFF;
            border-radius: 12px;
            border: 1px solid #E0E0E0;
            box-shadow: 0 10px 24px rgba(0,0,0,0.08);
        }
        
        .thank-you-card.active {
            display: block;
        }
        
        .thank-you-card h3 {
            font-size: 1.5em;
            color: #2C2C2C;
            margin-bottom: 10px;
        }
        
        .thank-you-card p {
            color: #555;
            margin-bottom: 20px;
        }
        
        .thank-you-summary {
            display: grid;
            row-gap: 10px;
            font-size: 0.95em;
            color: #2C2C2C;
        }
        
        .thank-you-actions {
            display: flex;
            flex-wrap: wrap;
            gap: 12px;
            margin-top: 25px;
        }
        
        .thank-you-actions a,
        .thank-you-actions button {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            padding: 10px 18px;
            border-radius: 24px;
            border: 1px solid #B8860B;
            background: transparent;
            color: #B8860B;
            font-size: 0.9em;
            letter-spacing: 0.04em;
            text-transform: uppercase;
            text-decoration: none;
            cursor: pointer;
            transition: background 0.2s ease, color 0.2s ease;
        }
        
        .thank-you-actions button {
            border: none;
        }
        
        .thank-you-actions a:hover,
        .thank-you-actions button:hover {
            background: #B8860B;
            color: #FFFFFF;
        }
        
        .form-status {
            font-size: 0.9em;
            margin-top: 14px;
            letter-spacing: 0.03em;
        }
        
        .form-status.pending {
            color: #B8860B;
        }
        
        .form-status.success {
            color: #1F7A4D;
        }
        
        .form-status.error {
            color: #B00020;
        }
        
        .payment-options {
            background: linear-gradient(135deg, #1F1F1F 0%, #2E2E2E 100%);
            color: #F5F5F5;
            border-radius: 12px;
            padding: 30px;
            margin-top: 30px;
            box-shadow: 0 10px 22px rgba(0,0,0,0.18);
        }
        
        .payment-options .section-title {
            color: #FFFFFF;
        }
        
        .payment-buttons {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }
        
        .payment-button {
            display: flex;
            align-items: center;
            gap: 16px;
            padding: 24px 28px;
            border-radius: 12px;
            text-decoration: none;
            color: #FFFFFF;
            transition: all 0.3s ease;
            border: 2px solid #B8860B;
            position: relative;
            overflow: hidden;
            background: linear-gradient(135deg, #2C2C2C 0%, #1F1F1F 100%);
            box-shadow: 0 8px 20px rgba(184, 134, 11, 0.2);
        }
        
        .payment-button::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: linear-gradient(to right, #B8860B, #D4A522, #B8860B);
        }
        
        .payment-button:hover {
            background: linear-gradient(135deg, #1F1F1F 0%, #2C2C2C 100%);
            border-color: #D4A522;
            box-shadow: 0 12px 28px rgba(184, 134, 11, 0.35);
            transform: translateY(-3px);
        }
        
        .payment-button:hover::before {
            background: linear-gradient(to right, #D4A522, #F4E4C1, #D4A522);
            height: 4px;
        }
        
        .payment-icon {
            font-size: 2.8em;
            flex-shrink: 0;
            filter: drop-shadow(0 2px 4px rgba(184, 134, 11, 0.3));
        }
        
        .payment-details {
            flex: 1;
        }
        
        .payment-title {
            font-size: 1.15em;
            font-weight: 600;
            margin-bottom: 6px;
            text-transform: uppercase;
            letter-spacing: 0.06em;
            color: #FFFFFF;
            text-shadow: 0 1px 2px rgba(0,0,0,0.3);
        }
        
        .payment-amount {
            font-size: 1.5em;
            font-weight: bold;
            margin-bottom: 6px;
            color: #B8860B;
            text-shadow: 0 1px 2px rgba(0,0,0,0.3);
        }
        
        .payment-subtitle {
            font-size: 0.95em;
            opacity: 0.85;
            color: #E0E0E0;
            font-style: italic;
        }
        
        .payment-confirmation {
            background: linear-gradient(135deg, #2C2C2C 0%, #1F1F1F 100%);
            border: 2px solid #B8860B;
            border-radius: 12px;
            padding: 24px;
            margin-top: 24px;
            display: flex;
            align-items: center;
            gap: 18px;
            animation: slideIn 0.5s ease-out;
            box-shadow: 0 8px 20px rgba(184, 134, 11, 0.25);
        }
        
        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(-12px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .confirmation-icon {
            font-size: 2.2em;
            flex-shrink: 0;
            color: #B8860B;
            filter: drop-shadow(0 2px 4px rgba(184, 134, 11, 0.4));
        }
        
        .confirmation-text h4 {
            color: #B8860B;
            margin: 0 0 8px 0;
            font-size: 1.2em;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.04em;
        }
        
        .confirmation-text p {
            color: #E0E0E0;
            margin: 0;
            line-height: 1.6;
            font-size: 1.05em;
        }
        
        @media (max-width: 900px) {
            .container {
                margin: 0 10px;
            }
            
            .content {
                padding: 30px 24px;
            }
        }
        
        @media (max-width: 768px) {
            body {
                padding: 24px 16px;
            }
            
            .letterhead {
                padding: 28px 24px 18px;
            }
            
            .doc-header {
                padding: 26px 24px;
            }
            
            .content {
                padding: 26px 20px;
            }
            
            .digital-acceptance {
                margin-top: 36px;
                padding: 26px 22px;
            }
            
            .signature-form {
                gap: 20px;
            }
            
            .form-grid {
                grid-template-columns: 1fr;
                gap: 16px;
            }
            
            .signature-pad canvas {
                height: 150px;
            }
            
            .acceptance-checkbox {
                flex-direction: column;
            }
            
            .acceptance-checkbox input {
                margin-top: 0;
            }
            
            .accept-button {
                width: 100%;
                justify-content: center;
            }
            
            .thank-you-actions {
                flex-direction: column;
                align-items: stretch;
            }
            
            .payment-options {
                padding: 26px 22px;
            }
            
            .cashapp-callout {
                gap: 22px;
            }
        }
        
        @media (max-width: 520px) {
            body {
                padding: 20px 12px;
            }
            
            .letterhead,
            .doc-header,
            .content {
                padding-left: 18px;
                padding-right: 18px;
            }
            
            .digital-acceptance {
                padding: 22px 16px;
            }
            
            .signature-pad canvas {
                height: 135px;
            }
            
            .acceptance-checkbox span {
                font-size: 0.92em;
            }
            
            .thank-you-card {
                padding: 24px 18px;
            }
            
            .payment-options {
                padding: 22px 18px;
            }
        }
        
        /* Footer */
        .footer {
            background: #2C2C2C;
            color: #F8F8F8;
            padding: 25px 60px;
            text-align: center;
        }
        
        .footer-main {
            font-size: 1em;
            margin-bottom: 12px;
            font-weight: 600;
        }
        
        .footer-divider {
            width: 100px;
            height: 2px;
            background: #B8860B;
            margin: 15px auto;
        }
        
        .footer-contact {
            font-size: 0.85em;
            color: #D0D0D0;
        }
        
        .footer-tagline {
            margin-top: 12px;
            font-size: 0.8em;
            color: #B8860B;
            font-style: italic;
        }
        
        /* Print Button */
        .print-button {
            background: #2C2C2C;
            color: white;
            padding: 15px 40px;
            border: none;
            border-radius: 6px;
            font-size: 1.1em;
            cursor: pointer;
            font-family: Georgia, serif;
            transition: background 0.3s;
        }
        
        .print-button:hover {
            background: #B8860B;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Letterhead -->
        <div class="letterhead">
            <div class="company-name">KMJK</div>
            <div class="gold-underline"></div>
            <div class="tagline">Professional Home Improvement Services</div>
            <div class="contact-info">
                <div class="contact-item">
                    <span class="contact-icon">üìç</span>
                    <span>Josue Lopez - Stuart, Florida</span>
                </div>
                <div class="contact-item">
                    <span class="contact-icon">üìû</span>
                    <span>772-323-3776</span>
                </div>
                <div class="contact-item">
                    <span class="contact-icon">‚úâÔ∏è</span>
                    <span>sway@kmjk.pro</span>
                </div>
            </div>
        </div>
        
        <!-- Document Header -->
        <div class="doc-header">
            <div class="doc-header-top">
                <div>
                    <h1 class="doc-title">Nordstrom Staircase Painting & Revival</h1>
                </div>
                <div class="estimate-number">
                    <div class="estimate-label">Estimate #</div>
                    <div class="estimate-value">KMJK-2025-1210-S</div>
                    <div class="estimate-label" style="margin-top: 10px;">Date Issued</div>
                    <div style="font-weight: 600; color: #2C2C2C;">December 10, 2025</div>
                </div>
            </div>
            
            <div class="client-info-grid">
                <div class="info-block">
                    <h3>Client Information</h3>
                    <p class="highlight">Sally Haddad & Jenny Vitale</p>
                    <p>sally.m.haddad@nordstrom.com</p>
                    <p>jenny.vitale@nordstrom.com</p>
                    <p>chase.mccullon@nordstrom.com</p>
                    <p>+1 (786) 644-9499</p>
                </div>
                <div class="info-block">
                    <h3>Project Location</h3>
                    <p class="highlight">Nordstrom Store - Boca Raton</p>
                    <p>6000 Glades Rd</p>
                    <p>Boca Raton, FL 33431</p>
                </div>
            </div>
        </div>
        
        <!-- Content -->
        <div class="content">
            <!-- Project Snapshot -->
            <div class="section">
                <h2 class="section-title">
                    <span class="section-icon">üß≠</span>
                    Project Snapshot
                </h2>
                <p style="color: #2C2C2C; font-size: 1.02em; line-height: 1.7;">
                    KMJK will provide comprehensive staircase painting and revival services for the Nordstrom Store location in Boca Raton. 
                    Our professional team will strip previous paint, prime, prep, and paint three flights of stairs including landings.
                    We will also refresh the rails with a luxury palette featuring a greige/charcoal revamp, ensuring a modern and durable finish.
                </p>
            </div>
            
            <!-- Scope of Work -->
            <div class="section">
                <h2 class="section-title">
                    <span class="section-icon">üìã</span>
                    Scope of Work
                </h2>
                <div class="work-items">
                    <div class="work-item">
                        <div class="work-item-bullet">‚Ä¢</div>
                        <div class="work-item-text">
                            <strong>Paint Stripping:</strong> Complete removal of previous paint layers from stairs and landings to ensure a clean base
                        </div>
                    </div>
                    <div class="work-item">
                        <div class="work-item-bullet">‚Ä¢</div>
                        <div class="work-item-text">
                            <strong>Surface Preparation:</strong> Comprehensive priming and prep of three flights of stairs and landings
                        </div>
                    </div>
                    <div class="work-item">
                        <div class="work-item-bullet">‚Ä¢</div>
                        <div class="work-item-text">
                            <strong>Staircase Painting:</strong> Application of high-quality paint to three flights of stairs and landings
                        </div>
                    </div>
                    <div class="work-item">
                        <div class="work-item-bullet">‚Ä¢</div>
                        <div class="work-item-text">
                            <strong>Rail Refinishing:</strong> Painting rails with a refreshed luxury palette (greige/charcoal revamp)
                        </div>
                    </div>
                    <div class="work-item">
                        <div class="work-item-bullet">‚Ä¢</div>
                        <div class="work-item-text">
                            <strong>Site Protection:</strong> Careful protection of surrounding areas during stripping and painting work
                        </div>
                    </div>
                </div>
            </div>

            <!-- Envision Your Project -->
            <div class="section" style="page-break-before: always;">
                <h2 class="section-title">
                    <span class="section-icon">üëÅÔ∏è</span>
                    Envision Your Project
                </h2>
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-top: 20px;">
                    <div style="background: white; padding: 15px; border: 1px solid #E0E0E0; border-radius: 8px;">
                        <h4 style="color: #B8860B; margin-bottom: 10px; text-transform: uppercase; font-size: 0.9em;">Current State</h4>
                        <img src="images/stairsbefore.jpeg" alt="Before Stairs" style="width: 100%; height: auto; border-radius: 4px; display: block;">
                    </div>
                    <div style="background: white; padding: 15px; border: 1px solid #E0E0E0; border-radius: 8px;">
                        <h4 style="color: #B8860B; margin-bottom: 10px; text-transform: uppercase; font-size: 0.9em;">Future Vision</h4>
                        <img src="images/afterrailspreview.jpg" alt="After Rails Preview" style="width: 100%; height: auto; border-radius: 4px; display: block;">
                        <p style="margin-top: 10px; font-size: 0.9em; color: #555;">Refreshed luxury palette with a greige/charcoal revamp.</p>
                    </div>
                </div>
            </div>
            
            <!-- Pricing -->
            <div class="section">
                <h2 class="section-title">
                    <span class="section-icon">üí∞</span>
                    Investment Breakdown
                </h2>
                <table class="pricing-table">
                    <thead>
                        <tr>
                            <th>Description</th>
                            <th>Details</th>
                            <th>Amount</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td><strong>Staircase Revival Package</strong></td>
                            <td>Strip paint, prime, prep, and paint 3 flights of stairs + landings; Rail refinishing in luxury greige/charcoal</td>
                            <td>$2,056.07</td>
                        </tr>
                        <tr class="tax-row">
                            <td colspan="2">Florida Sales Tax (7%)</td>
                            <td>$143.93</td>
                        </tr>
                        <tr class="total-row">
                            <td colspan="2"><strong>Total Project Investment</strong></td>
                            <td class="total-amount">$2,200.00</td>
                        </tr>
                    </tbody>
                </table>
            </div>
            
            <!-- Payment Schedule -->
            <div class="section">
                <h2 class="section-title">
                    <span class="section-icon">üí≥</span>
                    Payment Schedule
                </h2>
                <div class="payment-schedule">
                    <div class="payment-card">
                        <div class="payment-number">1</div>
                        <div class="payment-title">Project Deposit</div>
                        <div class="payment-detail"><strong>When:</strong> Due upon project approval</div>
                        <div class="payment-detail"><strong>Amount:</strong> 50% of total investment</div>
                        <div class="payment-amount">$1,100.00</div>
                    </div>
                    <div class="payment-card">
                        <div class="payment-number">2</div>
                        <div class="payment-title">Final Completion</div>
                        <div class="payment-detail"><strong>When:</strong> Due upon project completion</div>
                        <div class="payment-detail"><strong>Amount:</strong> Remaining 50% balance</div>
                        <div class="payment-amount">$1,100.00</div>
                    </div>
                </div>
                
                <div style="background: #E8F4F8; padding: 15px; border-radius: 6px; margin-top: 20px; text-align: center;">
                    <p style="color: #2C2C2C; margin: 0;"><strong>Accepted Payment Methods:</strong> Check, ACH, Zelle, Credit/Debit Card. Cash App welcomed with the 3% convenience adjustment noted above.</p>
                </div>
            </div>
            
            <!-- Payment Options -->
            <div class="section payment-options">
                <h2 class="section-title">
                    <span class="section-icon">üí≥</span>
                    Payment Options
                </h2>
                <div class="payment-instructions">
                    <p style="color: #E8E8E8; margin-bottom: 24px; font-size: 1.08em; line-height: 1.7;">
                        Experience the convenience of secure online payments through QuickBooks Payments. 
                        Our streamlined payment process ensures your project moves forward with confidence and professionalism.
                    </p>
                    <div class="payment-buttons">
                        <a href="https://connect.intuit.com/t/scs-v1-6b004fad1ae14b28b934f81196e7d997a79f5ffb978f4107910d3499522a8776ba4d5c1d5794472fa1d2817a8a91f8d6?cta=viewinvoicenow&locale=en_US" 
                           class="payment-button" 
                           target="_blank" 
                           rel="noopener"
                           onclick="handlePaymentClick('deposit', '$1,100.00')">
                            <span class="payment-icon">üí∞</span>
                            <div class="payment-details">
                                <div class="payment-title">Secure Your Project</div>
                                <div class="payment-amount">$1,100.00</div>
                                <div class="payment-subtitle">50% deposit to begin your transformation</div>
                            </div>
                        </a>
                        <a href="https://connect.intuit.com/t/scs-v1-6b004fad1ae14b28b934f81196e7d997a79f5ffb978f4107910d3499522a8776ba4d5c1d5794472fa1d2817a8a91f8d6?cta=viewinvoicenow&locale=en_US" 
                           class="payment-button" 
                           target="_blank" 
                           rel="noopener"
                           onclick="handlePaymentClick('full', '$2,200.00')">
                            <span class="payment-icon">‚ú®</span>
                            <div class="payment-details">
                                <div class="payment-title">Complete Investment</div>
                                <div class="payment-amount">$2,200.00</div>
                                <div class="payment-subtitle">Full payment for seamless project execution</div>
                            </div>
                        </a>
                    </div>
                    <div id="payment-confirmation" class="payment-confirmation" style="display: none;">
                        <div class="confirmation-icon">‚ú®</div>
                        <div class="confirmation-text">
                            <h4>Payment Portal Access</h4>
                            <p>You're being redirected to our secure QuickBooks payment gateway to complete your <strong>transaction</strong>. 
                            Thank you for choosing KMJK for your home improvement journey.</p>
                        </div>
                    </div>
                    <p style="margin-top: 28px; color: #B8B8B8; font-size: 0.92em; line-height: 1.6; text-align: center; font-style: italic;">
                        <strong>Security & Trust:</strong> All transactions protected by QuickBooks bank-level encryption. 
                        Your payment information is never stored on our servers. Questions? Contact Josue Lopez at 772-323-3776.
                    </p>
                </div>
            </div>
            
            <!-- Terms & Conditions -->
            <div class="section">
                <h2 class="section-title">
                    <span class="section-icon">üìÑ</span>
                    Terms & Conditions
                </h2>
                <div class="terms-box">
                    <h4>Project Terms:</h4>
                    <ul>
                        <li>This estimate is valid for 30 days from the date of issue</li>
                        <li>50% deposit required upon project approval to secure scheduling and materials</li>
                        <li>Final 50% payment due upon project completion and client satisfaction</li>
                        <li>All work performed by licensed and insured professionals; COI available upon request</li>
                        <li>KMJK carries full liability insurance and workers' compensation coverage</li>
                        <li>Work scheduled to minimize disruption to store operations</li>
                        <li>Client provides clear access to work areas and removes any fragile items</li>
                        <li>Materials included as specified; any additional work requires separate quote</li>
                    </ul>
                </div>
            </div>
            
            <!-- Validity Notice -->
            <div class="validity-notice">
                <p>This estimate is valid until:</p>
                <p class="validity-date">December 31, 2025</p>
            </div>
            
            <!-- Signature Section (Print Version) -->
            <div class="section signature-section print-only">
                <p style="font-size: 1.1em; color: #2C2C2C; margin-bottom: 20px; text-align: center;">
                    <strong>By signing below, you authorize KMJK to proceed with the work described in this estimate.</strong>
                </p>
                
                <div class="signature-grid">
                    <div class="signature-block">
                        <h4>For KMJK</h4>
                        <div class="signature-line">
                            <div class="sig-name">Josue Lopez</div>
                            <div class="sig-label">Owner, KMJK Home Improvement</div>
                            <div class="sig-date">Date: _____________________</div>
                        </div>
                    </div>
                    
                    <div class="signature-block">
                        <h4>Client Acceptance</h4>
                        <div class="signature-line">
                            <div class="sig-name">Sally Haddad</div>
                            <div class="sig-label">Client Signature</div>
                            <div class="sig-date">Date: _____________________</div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Digital Acceptance -->
            <div class="section digital-acceptance no-print">
                <h2 class="section-title">
                    <span class="section-icon">&#9998;</span>
                    Digital Project Authorization
                </h2>
                <p style="margin-top: 12px; color: #444;">Complete the electronic authorization below to approve the scope of work and payment schedule outlined in this estimate.</p>
                
                <form id="signatureForm" class="signature-form" novalidate>
                    <div class="form-grid">
                        <div class="form-field">
                            <label for="signerName">Full Name</label>
                            <input type="text" id="signerName" name="signerName" placeholder="Enter your legal name" autocomplete="name" required>
                        </div>
                        <div class="form-field">
                            <label for="signerDob">Date of Birth</label>
                            <input type="date" id="signerDob" name="signerDob" required>
                        </div>
                        <div class="form-field">
                            <label for="typedSignature">Type Your Signature</label>
                            <input type="text" id="typedSignature" name="typedSignature" placeholder="Re-type your name to sign" autocomplete="name" required>
                        </div>
                    </div>
                    
                    <div class="signature-pad">
                        <p>Optional: Draw your signature below using your mouse, stylus, or touch device.</p>
                        <canvas id="signatureCanvas" aria-label="Draw your signature"></canvas>
                        <div class="signature-actions">
                            <button type="button" id="clearSignature">Clear Signature</button>
                        </div>
                    </div>
                    
                    <label class="acceptance-checkbox">
                        <input type="checkbox" id="acceptTerms">
                        <span>I, <span id="agreeNamePreview">your name</span>, certify that I am the person named above and authorize KMJK Home Improvement to proceed with the services described.</span>
                    </label>
                    
                    <button type="submit" id="acceptButton" class="accept-button" disabled>
                        I Accept &amp; Sign
                    </button>
                    
                    <div id="formStatus" class="form-status hidden"></div>
                </form>
                
                <div id="thankYouCard" class="thank-you-card">
                    <h3>Thank you, <span id="thankYouName"></span>!</h3>
                    <p>We&rsquo;ve recorded your authorization and prepared an email confirmation for the KMJK team.</p>
                    <div class="thank-you-summary">
                        <div><strong>Signed On:</strong> <span id="thankYouTimestamp"></span></div>
                        <div><strong>Date of Birth:</strong> <span id="thankYouDob"></span></div>
                        <div><strong>Typed Signature:</strong> <span id="thankYouTyped"></span></div>
                        <div><strong>Drawn Signature:</strong> <span id="thankYouSketch"></span></div>
                    </div>
                    <div class="thank-you-actions">
                        <a id="signatureDownload" class="hidden" download="kmjk-digital-signature.png">Download Signature</a>
                        <button type="button" id="printReceiptButton">Print Confirmation</button>
                    </div>
                </div>
            </div>
            
            <!-- Thank You Note -->
            <div style="margin-top: 40px; padding: 25px; background: linear-gradient(135deg, #F8F8F8 0%, #FFFFFF 100%); border-radius: 8px; text-align: center; border: 1px solid #E0E0E0;">
                <p style="font-size: 1.2em; color: #B8860B; font-weight: 600; margin-bottom: 10px;">Thank You for Choosing KMJK</p>
                <p style="color: #555; line-height: 1.7;">We appreciate the opportunity to work with you on this project. Our team is committed to delivering exceptional quality and service. If you have any questions about this estimate, please don't hesitate to contact us.</p>
            </div>
        </div>
        
        <!-- Footer -->
        <div class="footer">
            <div class="footer-main">KMJK Home Improvement</div>
            <div class="footer-divider"></div>
            <div class="footer-contact">Stuart, FL | 772-323-3776 | sway@kmjk.pro</div>
            <div class="footer-tagline">Building Excellence, One Project at a Time</div>
        </div>
    </div>
    
    <!-- Print Button -->
    <div class="no-print" style="text-align: center; margin-top: 30px; padding: 20px;">
        <button onclick="window.print()" class="print-button">
            üñ®Ô∏è Print Estimate
        </button>
    </div>
    <script>
        document.addEventListener('DOMContentLoaded', function () {
            const form = document.getElementById('signatureForm');
            if (!form) {
                return;
            }
            
            const signerName = document.getElementById('signerName');
            const signerDob = document.getElementById('signerDob');
            const typedSignature = document.getElementById('typedSignature');
            const acceptTerms = document.getElementById('acceptTerms');
            const acceptButton = document.getElementById('acceptButton');
            const agreeNamePreview = document.getElementById('agreeNamePreview');
            const thankYouCard = document.getElementById('thankYouCard');
            const thankYouName = document.getElementById('thankYouName');
            const thankYouTimestamp = document.getElementById('thankYouTimestamp');
            const thankYouDob = document.getElementById('thankYouDob');
            const thankYouTyped = document.getElementById('thankYouTyped');
            const thankYouSketch = document.getElementById('thankYouSketch');
            const signatureDownload = document.getElementById('signatureDownload');
            const printReceiptButton = document.getElementById('printReceiptButton');
            const formStatus = document.getElementById('formStatus');
            const web3formsEndpoint = 'https://api.web3forms.com/submit';
            const web3formsAccessKey = '8e63e7e3-ab53-43a9-80c5-ebc113c25912';
            
            const setStatus = function (state, message) {
                if (!formStatus) {
                    return;
                }
                formStatus.textContent = message || '';
                formStatus.classList.remove('pending', 'success', 'error');
                if (!state) {
                    formStatus.classList.add('hidden');
                    return;
                }
                formStatus.classList.remove('hidden');
                formStatus.classList.add(state);
            };
            
            const canvas = document.getElementById('signatureCanvas');
            const clearSignatureButton = document.getElementById('clearSignature');
            const estimateValueElement = document.querySelector('.estimate-value');
            const estimateNumber = estimateValueElement ? estimateValueElement.textContent.trim() : 'KMJK Estimate';
            
            let userEditedTypedSignature = false;
            let hasDrawnSignature = false;
            let isDrawing = false;
            let ctx = null;
            
            if (canvas && canvas.getContext) {
                ctx = canvas.getContext('2d');
                
                const prepareCanvas = function () {
                    const rect = canvas.getBoundingClientRect();
                    canvas.width = rect.width;
                    canvas.height = rect.height;
                    ctx.fillStyle = '#FFFFFF';
                    ctx.fillRect(0, 0, canvas.width, canvas.height);
                    ctx.lineWidth = 2;
                    ctx.lineCap = 'round';
                    ctx.strokeStyle = '#2C2C2C';
                };
                
                const getPosition = function (event) {
                    const rect = canvas.getBoundingClientRect();
                    return {
                        x: event.clientX - rect.left,
                        y: event.clientY - rect.top
                    };
                };
                
                const stopDrawing = function (event) {
                    if (!isDrawing) {
                        return;
                    }
                    isDrawing = false;
                    ctx.closePath();
                    if (event && typeof event.pointerId === 'number' && canvas.hasPointerCapture && canvas.hasPointerCapture(event.pointerId)) {
                        canvas.releasePointerCapture(event.pointerId);
                    }
                };
                
                prepareCanvas();
                
                canvas.addEventListener('pointerdown', function (event) {
                    if (!ctx) {
                        return;
                    }
                    isDrawing = true;
                    const position = getPosition(event);
                    ctx.beginPath();
                    ctx.moveTo(position.x, position.y);
                    hasDrawnSignature = true;
                    if (typeof event.pointerId === 'number') {
                        canvas.setPointerCapture(event.pointerId);
                    }
                    event.preventDefault();
                });
                
                canvas.addEventListener('pointermove', function (event) {
                    if (!isDrawing || !ctx) {
                        return;
                    }
                    const position = getPosition(event);
                    ctx.lineTo(position.x, position.y);
                    ctx.stroke();
                    event.preventDefault();
                });
                
                canvas.addEventListener('pointerup', stopDrawing);
                canvas.addEventListener('pointerleave', stopDrawing);
                canvas.addEventListener('pointercancel', stopDrawing);
                
                if (clearSignatureButton) {
                    clearSignatureButton.addEventListener('click', function () {
                        prepareCanvas();
                        hasDrawnSignature = false;
                    });
                }
            } else if (clearSignatureButton) {
                clearSignatureButton.classList.add('hidden');
            }
            
            const updateNamePreview = function () {
                const value = signerName.value.trim();
                agreeNamePreview.textContent = value || 'your name';
                if (!userEditedTypedSignature) {
                    typedSignature.value = value;
                }
            };
            
            const updateButtonState = function () {
                const valid = signerName.value.trim().length > 0 &&
                    signerDob.value &&
                    typedSignature.value.trim().length > 0 &&
                    acceptTerms.checked;
                acceptButton.disabled = !valid;
            };
            
            signerName.addEventListener('input', function () {
                updateNamePreview();
                updateButtonState();
            });
            
            signerDob.addEventListener('change', updateButtonState);
            signerDob.addEventListener('input', updateButtonState);
            
            typedSignature.addEventListener('input', function () {
                userEditedTypedSignature = typedSignature.value.trim() !== signerName.value.trim();
                updateButtonState();
            });
            
            acceptTerms.addEventListener('change', updateButtonState);
            
            updateNamePreview();
            updateButtonState();
            
            form.addEventListener('submit', async function (event) {
                event.preventDefault();
                updateButtonState();
                if (acceptButton.disabled) {
                    return;
                }
                
                acceptButton.disabled = true;
                setStatus('pending', 'Submitting authorization...');
                
                const name = signerName.value.trim();
                const dobValue = signerDob.value;
                const typedValue = typedSignature.value.trim();
                const signedDate = new Date();
                
                const signedDisplay = signedDate.toLocaleString(undefined, { dateStyle: 'long', timeStyle: 'short' });
                let dobDisplay = 'N/A';
                if (dobValue) {
                    const dobDate = new Date(dobValue + 'T00:00:00');
                    if (!Number.isNaN(dobDate.getTime())) {
                        dobDisplay = dobDate.toLocaleDateString(undefined, { dateStyle: 'long' });
                    } else {
                        dobDisplay = dobValue;
                    }
                }
                
                const projectTotalElement = document.querySelector('.total-amount');
                const projectTotal = projectTotalElement ? projectTotalElement.textContent.trim() : '';
                const signatureImageData = hasDrawnSignature && canvas && canvas.toDataURL ? canvas.toDataURL('image/png') : '';
                const summaryTextLines = [
                    'Estimate: ' + estimateNumber,
                    'Client Name: ' + name,
                    'Date of Birth: ' + dobDisplay,
                    'Typed Signature: ' + typedValue,
                    'Drawn Signature Captured: ' + (hasDrawnSignature ? 'Yes' : 'No'),
                    'Signed On: ' + signedDisplay,
                    projectTotal ? 'Project Total: ' + projectTotal : null
                ].filter(Boolean);
                const summaryText = summaryTextLines.join('\n');
                const summaryHtml = [
                    '<h3 style=\"margin:0 0 12px 0;font-family:Georgia,serif;color:#2C2C2C;\">Digital Authorization Summary</h3>',
                    '<p style=\"margin:0 0 6px 0;font-family:Georgia,serif;color:#2C2C2C;\"><strong>Estimate:</strong> ' + estimateNumber + '</p>',
                    '<p style=\"margin:0 0 6px 0;font-family:Georgia,serif;color:#2C2C2C;\"><strong>Client Name:</strong> ' + name + '</p>',
                    '<p style=\"margin:0 0 6px 0;font-family:Georgia,serif;color:#2C2C2C;\"><strong>Date of Birth:</strong> ' + dobDisplay + '</p>',
                    '<p style=\"margin:0 0 6px 0;font-family:Georgia,serif;color:#2C2C2C;\"><strong>Typed Signature:</strong> ' + typedValue + '</p>',
                    projectTotal ? '<p style=\"margin:0 0 6px 0;font-family:Georgia,serif;color:#2C2C2C;\"><strong>Project Total:</strong> ' + projectTotal + '</p>' : '',
                    '<p style=\"margin:0 0 12px 0;font-family:Georgia,serif;color:#2C2C2C;\"><strong>Signed On:</strong> ' + signedDisplay + '</p>',
                    hasDrawnSignature && signatureImageData
                        ? '<div><p style=\"margin:0 0 8px 0;font-family:Georgia,serif;color:#2C2C2C;\"><strong>Drawn Signature:</strong></p><img src=\"' + signatureImageData + '\" alt=\"Drawn signature\" style=\"max-width:320px;border:1px solid #ddd;border-radius:6px;\"></div>'
                        : '<p style=\"margin:0;font-family:Georgia,serif;color:#2C2C2C;\"><strong>Drawn Signature:</strong> Not provided</p>'
                ].join('');
                
                const formData = new FormData();
                formData.append('access_key', web3formsAccessKey);
                formData.append('subject', 'Digital Acceptance - ' + estimateNumber);
                formData.append('name', name);
                formData.append('email', 'sway@kmjk.pro');
                
                // Put ALL information in the message field for Web3Forms
                const fullMessage = `
DIGITAL ACCEPTANCE - ESTIMATE SIGNED

ESTIMATE DETAILS:
Estimate Number: ${estimateNumber}
Project Total: ${projectTotal || 'N/A'}
Location: ${window.location.href}

CLIENT INFORMATION:
Client Name: ${name}
Date of Birth: ${dobDisplay}
Email: sway@kmjk.pro

SIGNATURE DETAILS:
Typed Signature: ${typedValue}
Drawn Signature: ${hasDrawnSignature ? 'Yes - Captured' : 'Not provided'}
Signed On: ${signedDisplay}

VERIFICATION:
- Client certified they are the person named above
- Authorization to proceed with services confirmed
- Terms and conditions accepted
                `.trim();
                
                formData.append('message', fullMessage);
                
                try {
                    const response = await fetch(web3formsEndpoint, {
                        method: 'POST',
                        headers: {
                            Accept: 'application/json'
                        },
                        body: formData
                    });
                    const result = await response.json();
                    if (!result.success) {
                        throw new Error(result.message || 'Submission failed.');
                    }
                    
                    thankYouName.textContent = name;
                    thankYouTimestamp.textContent = signedDisplay;
                    thankYouDob.textContent = dobDisplay;
                    thankYouTyped.textContent = typedValue;
                    thankYouSketch.textContent = hasDrawnSignature ? 'Captured (download below)' : 'Not provided';
                    
                    if (signatureDownload) {
                        if (signatureImageData) {
                            signatureDownload.href = signatureImageData;
                            signatureDownload.download = 'kmjk-digital-signature-' + Date.now() + '.png';
                            signatureDownload.classList.remove('hidden');
                        } else {
                            signatureDownload.classList.add('hidden');
                        }
                    }
                    
                    thankYouCard.classList.add('active');
                    setStatus('success', 'Authorization received. A confirmation email has been sent to KMJK.');
                    
                    Array.prototype.forEach.call(form.elements, function (element) {
                        if (element === printReceiptButton || element.tagName.toLowerCase() === 'a') {
                            return;
                        }
                        element.disabled = true;
                    });
                } catch (error) {
                    console.error('Digital acceptance submission failed:', error);
                    setStatus('error', 'Could not submit the authorization. Please try again or contact KMJK.');
                    updateButtonState();
                    return;
                }
            });
            
            if (printReceiptButton) {
                printReceiptButton.addEventListener('click', function () {
                    window.print();
                });
            }
            
            // Payment confirmation handler
            window.handlePaymentClick = function(paymentType, amount) {
                const confirmationDiv = document.getElementById('payment-confirmation');
                const confirmationText = confirmationDiv.querySelector('.confirmation-text h4');
                const confirmationDesc = confirmationDiv.querySelector('.confirmation-text p');
                
                confirmationText.textContent = `Payment Initiated - ${paymentType === 'deposit' ? '50% Deposit' : 'Full Payment'}`;
                confirmationDesc.innerHTML = `You will be redirected to QuickBooks secure payment portal to complete your <strong>${amount}</strong> transaction. 
                Thank you for your business!`;
                
                confirmationDiv.style.display = 'flex';
                
                // Scroll to confirmation message
                confirmationDiv.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
                
                // Hide confirmation after 10 seconds
                setTimeout(() => {
                    confirmationDiv.style.display = 'none';
                }, 10000);
            };
        });
    </script>
</body>
</html>
